C51 COMPILER V9.00   ATCMD                                                                 06/19/2015 17:40:20 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE ATCMD
OBJECT MODULE PLACED IN .\Object\ATCmd.obj
COMPILER INVOKED BY: d:\Keil\C51\BIN\C51.EXE user\ATCmd\ATCmd.c LARGE BROWSE INCDIR(.\user\LCD;.\user\W25Qxx;.\user;.\us
                    -er\TOUCH;.\user\flash;.\user\ds1302;.\user\timer;.\user\GUI;.\user\ds18b20;.\user\uart;.\user\ATCmd) DEBUG OBJECTEXTEND 
                    -PRINT(.\Lst\ATCmd.lst) OBJECT(.\Object\ATCmd.obj)

line level    source

   1          #include "ATCmd.h"
   2          #include "gui.h"
   3          #include "ds1302.h"
   4          #include "uart.h"
   5          #include "18b20.h"
   6          #include<string.h>
   7          #define ATNUM 7         //AT指令的数量
   8          //私有函数
   9          void stime();
  10          void stempert();
  11          /**************************
  12          AT指令的类型的结构体            
  13          第一成员为指令串 (不超过10个字符，含\0)
  14          第二成员为对应指令的函数名      
  15          ***************************/
  16          typedef struct           
  17          {
  18                  char at_name[10];
  19                  void (*at_fun)();
  20          }at_cmd;
  21          at_cmd code at[ATNUM]=                  //AT指令列表
  22          {
  23                  {"desktop",desktop},
  24                  {"startch",start_check},
  25                  {"picbox",picbox},
  26                  {"tempert",tempert},
  27                  {"calendar",calendar},
  28                  {"stime",stime},
  29                  {"stempert",stempert},
  30          };
  31          /******************************
  32          函数名：AT_DO
  33          作用：查阅AT指令串并执行对应函数
  34          参数：at_str 串口接收到的AT指令串
  35          ********************************/
  36          void AT_DO(u8 *at_str)
  37          {
  38   1              u8 i;
  39   1              at_str=at_str+3;//清除指令头3个字符"AT+"
  40   1              for(i=0;i<ATNUM;i++)
  41   1              {
  42   2                      if(strcmp(at_str,at[i].at_name)==0) at[i].at_fun();
  43   2              }
  44   1      }
  45          /***********************************
  46          函数名：IsATCmd
  47          作用:检查字符串是否AT指令(串开头三个字符是AT+)
  48          返回值：1 是   0 不是
  49          *************************************/
  50          bit IsATCmd(u8 *str)
  51          {
  52   1              if(*str=='A'&&*(str+1)=='T') return 1;
  53   1              return 0;
C51 COMPILER V9.00   ATCMD                                                                 06/19/2015 17:40:20 PAGE 2   

  54   1      }
  55          /*************************
  56          函数名:stime
  57          功能获取当前时间并从串口
  58          发送回上位机
  59          **************************/
  60          void stime()
  61          {
  62   1              extern u8 time[22];
  63   1              gettime(time);
  64   1              UART_SendStr(time);
  65   1      }
  66          /*************************
  67          函数名:stempert
  68          功能获取当前时间并从串口
  69          发送回上位机
  70          **************************/
  71          void stempert()
  72          {
  73   1              u8 temper[7];
  74   1              ReadTemperature(temper);
  75   1              UART_SendStr(temper);
  76   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    172    ----
   CONSTANT SIZE    =     91    ----
   XDATA SIZE       =   ----      11
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
