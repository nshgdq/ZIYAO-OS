C51 COMPILER V9.00   ATCMD                                                                 06/22/2015 13:15:16 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE ATCMD
OBJECT MODULE PLACED IN .\Object\ATCmd.obj
COMPILER INVOKED BY: d:\Keil\C51\BIN\C51.EXE user\ATCmd\ATCmd.c LARGE BROWSE INCDIR(.\user\LCD;.\user\W25Qxx;.\user;.\us
                    -er\TOUCH;.\user\flash;.\user\ds1302;.\user\timer;.\user\GUI;.\user\ds18b20;.\user\uart;.\user\ATCmd;.\user\led) DEBUG OB
                    -JECTEXTEND PRINT(.\Lst\ATCmd.lst) OBJECT(.\Object\ATCmd.obj)

line level    source

   1          #include "ATCmd.h"
   2          #include "gui.h"
   3          #include "ds1302.h"
   4          #include "uart.h"
   5          #include "18b20.h"
   6          #include<string.h>
   7          #define ATNUM 8         //AT指令的数量
   8          //私有函数
   9          void stime();
  10          void stempert();
  11          void link();
  12          void ATErr();
  13          //******************
  14          /**************************
  15          AT指令的类型的结构体            
  16          第一成员为指令串 (不超过10个字符，含\0)
  17          第二成员为对应指令的函数名      
  18          ***************************/
  19          typedef struct           
  20          {
  21                  char at_name[10];
  22                  void (*at_fun)();
  23          }at_cmd;
  24          at_cmd code at[ATNUM]=                  //AT指令列表
  25          {
  26                  {"link",link},
  27                  {"desktop",desktop},
  28                  {"startch",start_check},
  29                  {"picbox",picbox},
  30                  {"tempert",tempert},
  31                  {"calendar",calendar},
  32                  {"stime",stime},
  33                  {"stempert",stempert},
  34          };
  35          /******************************
  36          函数名：AT_DO
  37          作用：查阅AT指令串并执行对应函数
  38          参数：at_str 串口接收到的AT指令串
  39          ********************************/
  40          void AT_DO(u8 *at_str)
  41          {
  42   1              u8 i;
  43   1              at_str=at_str+3;//清除指令头3个字符"AT+"
  44   1              for(i=0;i<=ATNUM;i++)
  45   1              {
  46   2                      if(i==ATNUM) {ATErr();break;}
  47   2                      if(strcmp(at_str,at[i].at_name)==0) {at[i].at_fun();break;}
  48   2              }
  49   1      }
  50          /***********************************
  51          函数名：IsATCmd
  52          作用:检查字符串是否AT指令(串开头三个字符是AT+)
  53          返回值：1 是   0 不是
C51 COMPILER V9.00   ATCMD                                                                 06/22/2015 13:15:16 PAGE 2   

  54          *************************************/
  55          bit IsATCmd(u8 *str)
  56          {
  57   1              if(*str=='A'&&*(str+1)=='T') return 1;
  58   1              return 0;
  59   1      }
  60          /*************************
  61          函数名:stime
  62          功能:获取当前时间并从串口
  63          发送回上位机
  64          **************************/
  65          void stime()
  66          {
  67   1              extern u8 time[22];
  68   1              gettime(time);
  69   1              UART_SendStr(time);
  70   1              UART_SendStr("\n");
  71   1      }
  72          /*************************
  73          函数名:stempert
  74          功能:获取当前温度并从串口
  75          发送回上位机
  76          **************************/
  77          void stempert()
  78          {
  79   1              u8 temper[7];
  80   1              ReadTemperature(temper);
  81   1              UART_SendStr(temper+1);
  82   1              UART_SendStr("\n");
  83   1      }
  84          /*************************
  85          函数名:link
  86          功能:检查串口连接，
  87          已连接返回OK
  88          **************************/
  89          void link()
  90          {
  91   1              UART_SendStr("OK\n");
  92   1      }
  93          /*************************
  94          函数名:ATErr
  95          功能:查AT表没有找到指令
  96          报错！
  97          **************************/
  98          void ATErr()
  99          {
 100   1              UART_SendStr("Not found!\n");
 101   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    218    ----
   CONSTANT SIZE    =    122    ----
   XDATA SIZE       =   ----      11
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
