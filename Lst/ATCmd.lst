C51 COMPILER V9.52.0.0   ATCMD                                                             07/18/2015 09:10:21 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE ATCMD
OBJECT MODULE PLACED IN .\Object\ATCmd.obj
COMPILER INVOKED BY: d:\Keil\C51\BIN\C51.EXE user\Driver\ATCmd.c LARGE BROWSE INCDIR(.\user\Include) DEBUG OBJECTEXTEND 
                    -PRINT(.\Lst\ATCmd.lst) TABS(2) OBJECT(.\Object\ATCmd.obj)

line level    source

   1          #include "ATCmd.h"
   2          #include "gui.h"
   3          #include "ds1302.h"
   4          #include "uart.h"
   5          #include "18b20.h"
   6          #include "led.h"
   7          #include<string.h>
   8          #define ATNUM 12    //AT指令的数量
   9          //私有函数
  10          void stime();
  11          void stempert();
  12          void link();
  13          void ATErr();
  14          void SWLED1();
  15          void SWLED2();
  16          void SWLED3();
  17          void OFFLed();
  18          //******************
  19          /**************************
  20          AT指令的类型的结构体    
  21          第一成员为指令串 (不超过10个字符，含\0)
  22          第二成员为对应指令的函数名  
  23          ***************************/
  24          typedef struct     
  25          {
  26            char at_name[10];
  27            void (*at_fun)();
  28          }at_cmd;
  29          at_cmd code at[ATNUM]=      //AT指令列表
  30          {
  31            {"link",link},
  32            {"desktop",desktop},
  33            {"startch",start_check},
  34            {"picbox",picbox},
  35            {"tempert",tempert},
  36            {"calendar",calendar},
  37            {"stime",stime},
  38            {"stempert",stempert},
  39            {"swled1",SWLED1},
  40            {"swled2",SWLED2},
  41            {"swled3",SWLED3},
  42            {"offled",OFFLed}
  43          };
  44          /******************************
  45          函数名：AT_DO
  46          作用：查阅AT指令串并执行对应函数
  47          参数：at_str 串口接收到的AT指令串
  48          ********************************/
  49          void AT_DO(u8 *at_str)
  50          {
  51   1        u8 i;
  52   1        at_str=at_str+3;//清除指令头3个字符"AT+"
  53   1        for(i=0;i<=ATNUM;i++)
  54   1        {
C51 COMPILER V9.52.0.0   ATCMD                                                             07/18/2015 09:10:21 PAGE 2   

  55   2          if(i==ATNUM) {ATErr();break;}
  56   2          if(strcmp(at_str,at[i].at_name)==0) {at[i].at_fun();break;}
  57   2        }
  58   1      }
  59          /***********************************
  60          函数名：IsATCmd
  61          作用:检查字符串是否AT指令(串开头三个字符是AT+)
  62          返回值：1 是   0 不是
  63          *************************************/
  64          bit IsATCmd(u8 *str)
  65          {
  66   1        if(*str=='A'&&*(str+1)=='T') return 1;
  67   1        return 0;
  68   1      }
  69          /*************************
  70          函数名:stime
  71          功能:获取当前时间并从串口
  72          发送回上位机
  73          **************************/
  74          void stime()
  75          {
  76   1        extern u8 time[22];
  77   1        gettime(time);
  78   1        UART_SendStr(time);
  79   1        UART_SendStr("\n");
  80   1      }
  81          /*************************
  82          函数名:stempert
  83          功能:获取当前温度并从串口
  84          发送回上位机
  85          **************************/
  86          void stempert()
  87          {
  88   1        u8 temper[7];
  89   1        ReadTemperature(temper);
  90   1        UART_SendStr(temper+1);
  91   1        UART_SendStr("\n");
  92   1      }
  93          /*************************
  94          函数名:link
  95          功能:检查串口连接，
  96          已连接返回OK
  97          **************************/
  98          void link()
  99          {
 100   1        UART_SendStr("OK\n");
 101   1      }
 102          /*************************
 103          函数名:ATErr
 104          功能:查AT表没有找到指令
 105          报错！
 106          **************************/
 107          void ATErr()
 108          {
 109   1        UART_SendStr("Not found!\n");
 110   1      }
 111          /*************************
 112          函数名:LED
 113          功能:改变LED状态
 114          *************************/
 115          void SWLED1()
 116          {
C51 COMPILER V9.52.0.0   ATCMD                                                             07/18/2015 09:10:21 PAGE 3   

 117   1        SetLed(1,!RedLed(1));
 118   1      }
 119          void SWLED2()
 120          {
 121   1        SetLed(2,!RedLed(2));
 122   1      }
 123          void SWLED3()
 124          {
 125   1        SetLed(3,!RedLed(3));
 126   1      }
 127          void OFFLed()
 128          {
 129   1        SetLed(1,1);
 130   1        SetLed(2,1);
 131   1        SetLed(3,1);
 132   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    278    ----
   CONSTANT SIZE    =    174    ----
   XDATA SIZE       =   ----      11
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
