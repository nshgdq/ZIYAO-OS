C51 COMPILER V9.00   ATCMD                                                                 06/20/2015 11:57:50 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE ATCMD
OBJECT MODULE PLACED IN .\Object\ATCmd.obj
COMPILER INVOKED BY: d:\Keil\C51\BIN\C51.EXE user\ATCmd\ATCmd.c LARGE BROWSE INCDIR(.\user\LCD;.\user\W25Qxx;.\user;.\us
                    -er\TOUCH;.\user\flash;.\user\ds1302;.\user\timer;.\user\GUI;.\user\ds18b20;.\user\uart;.\user\ATCmd) DEBUG OBJECTEXTEND 
                    -PRINT(.\Lst\ATCmd.lst) OBJECT(.\Object\ATCmd.obj)

line level    source

   1          #include "ATCmd.h"
   2          #include "gui.h"
   3          #include "ds1302.h"
   4          #include "uart.h"
   5          #include "18b20.h"
   6          #include<string.h>
   7          #define ATNUM 8         //AT指令的数量
   8          //私有函数
   9          void stime();
  10          void stempert();
  11          void link();
  12          //******************
  13          /**************************
  14          AT指令的类型的结构体            
  15          第一成员为指令串 (不超过10个字符，含\0)
  16          第二成员为对应指令的函数名      
  17          ***************************/
  18          typedef struct           
  19          {
  20                  char at_name[10];
  21                  void (*at_fun)();
  22          }at_cmd;
  23          at_cmd code at[ATNUM]=                  //AT指令列表
  24          {
  25                  {"link",link},
  26                  {"desktop",desktop},
  27                  {"startch",start_check},
  28                  {"picbox",picbox},
  29                  {"tempert",tempert},
  30                  {"calendar",calendar},
  31                  {"stime",stime},
  32                  {"stempert",stempert},
  33          };
  34          /******************************
  35          函数名：AT_DO
  36          作用：查阅AT指令串并执行对应函数
  37          参数：at_str 串口接收到的AT指令串
  38          ********************************/
  39          void AT_DO(u8 *at_str)
  40          {
  41   1              u8 i;
  42   1              at_str=at_str+3;//清除指令头3个字符"AT+"
  43   1              for(i=0;i<ATNUM;i++)
  44   1              {
  45   2                      if(strcmp(at_str,at[i].at_name)==0) at[i].at_fun();
  46   2              }
  47   1      }
  48          /***********************************
  49          函数名：IsATCmd
  50          作用:检查字符串是否AT指令(串开头三个字符是AT+)
  51          返回值：1 是   0 不是
  52          *************************************/
  53          bit IsATCmd(u8 *str)
C51 COMPILER V9.00   ATCMD                                                                 06/20/2015 11:57:50 PAGE 2   

  54          {
  55   1              if(*str=='A'&&*(str+1)=='T') return 1;
  56   1              return 0;
  57   1      }
  58          /*************************
  59          函数名:stime
  60          功能:获取当前时间并从串口
  61          发送回上位机
  62          **************************/
  63          void stime()
  64          {
  65   1              extern u8 time[22];
  66   1              gettime(time);
  67   1              UART_SendStr(time);
  68   1              UART_SendStr("\n");
  69   1      }
  70          /*************************
  71          函数名:stempert
  72          功能:获取当前温度并从串口
  73          发送回上位机
  74          **************************/
  75          void stempert()
  76          {
  77   1              u8 temper[7];
  78   1              ReadTemperature(temper);
  79   1              UART_SendStr(temper);
  80   1              UART_SendStr("\n");
  81   1      }
  82          /*************************
  83          函数名:link
  84          功能:检查串口连接，
  85          已连接返回OK
  86          **************************/
  87          void link()
  88          {
  89   1              UART_SendStr("OK\n");
  90   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    199    ----
   CONSTANT SIZE    =    110    ----
   XDATA SIZE       =   ----      11
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
