C51 COMPILER V9.52.0.0   CALENDAR                                                          07/20/2015 13:12:16 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE CALENDAR
OBJECT MODULE PLACED IN .\Object\calendar.obj
COMPILER INVOKED BY: d:\Keil\C51\BIN\C51.EXE user\App\calendar.c LARGE BROWSE INCDIR(.\user\Include) DEBUG OBJECTEXTEND 
                    -PRINT(.\Lst\calendar.lst) TABS(2) OBJECT(.\Object\calendar.obj)

line level    source

   1          /*********************
   2          日历
   3          *********************/
   4          #include "app.h"
   5          #include "Touch.h"
   6          #include "ds1302.h"
   7          //*****************************
   8          extern u8 time[22];
   9          extern void gettime(u8 *);
  10          extern u16 x,y;
  11          extern void Get_Click1(u16 *x,u16 *y);
  12          void t_menu();
  13          void t_alert();
  14          //*********************************
  15          //日历
  16          //*********************************
  17          void calendar()
  18          {
  19   1        u16 i=0;
  20   1        gettime(time);
  21   1        time[7]='\0';
  22   1        LCD_Clear(0x051d);
  23   1        LCD_DrawBox(60,60,120,20,Yellow);
  24   1        LCD_DrawBox(60,80,120,104,White);
  25   1        GUI_Text(61,61,time,Red,Nocolor);
  26   1        Show_Str(150,61,"周",16,Red,Nocolor);
  27   1        GUI_Text(166,61,time+20,Red,Nocolor);
  28   1        time[10]='\0';
  29   1        Show_Str(105,110,time+8,32,Red,Nocolor);
  30   1        guidshow();
  31   1        while(1)
  32   1        {
  33   2          if(i==0xbff||i==0)
  34   2          {
  35   3            gettime(time);
  36   3            time[16]='\0';
  37   3            GUI_Text(100,150,time+11,Red,White);
  38   3            i=1;
  39   3          }
  40   2          i++;
  41   2          Get_Click(&x,&y);
  42   2          if(y>288&&y<320) guiddo(desktop,t_menu,x);
  43   2        }
  44   1      }
  45          void t_menu()//菜单
  46          {
  47   1        LCD_Clear(0x051d);
  48   1        Show_Str(56,0,"时间选项",32,White,Nocolor);
  49   1        LCD_DrawLine(0,35,240,35,White);
  50   1        Show_Str(0,38,"◆设定系统时间",24,White,Nocolor);
  51   1        Show_Str(0,67,"◆闹钟",24,White,Nocolor);
  52   1        guidshow();
  53   1        while(1)
  54   1        {
C51 COMPILER V9.52.0.0   CALENDAR                                                          07/20/2015 13:12:16 PAGE 2   

  55   2          Get_Click(&x,&y);
  56   2          if(y>288&&y<320) guiddo(calendar,t_menu,x);
  57   2          if(y>38&&y<(38+24)) {Show_Str(0,38,"◆设定系统时间",24,White,Blue);sstmtime();}
  58   2          if(y>(38+24)&&y<(38+24+24)) {Show_Str(0,67,"◆闹钟",24,White,Blue);t_alert();}
  59   2        }
  60   1      }
  61          /**************
  62          设置系统时间
  63          ***************/
  64          void sstmtime()
  65          {
  66   1        u8 setime[7]={0,0,0,0,0,0,0},i=1;
  67   1        gettime(time);
  68   1        LCD_Clear(0x051d);
  69   1        Show_Str(24,20,"设置系统时间",32,White,Nocolor);
  70   1        GUI_Text(40,128,time,Red,White);
  71   1        LCD_DrawBox(100,105,40,20,0xc618);
  72   1        Show_Str(115,108,"▲",16,Black,Nocolor);
  73   1        LCD_DrawEBox(100,105,40,20,Blue);
  74   1        LCD_DrawBox(100,148,40,20,0xc618);
  75   1        Show_Str(115,153,"",16,Black,Nocolor);
  76   1        LCD_DrawEBox(100,148,40,20,Blue);
  77   1        LCD_DrawBox(40,180,40,20,0xc618);
  78   1        GUI_Text(42,182,"Next",Black,Nocolor);
  79   1        LCD_DrawEBox(40,180,40,20,Blue);
  80   1        LCD_DrawBox(170,180,40,20,0xc618);
  81   1        GUI_Text(185,182,"Ok",Black,Nocolor);
  82   1        LCD_DrawEBox(170,180,40,20,Blue);
  83   1        guidshow();
  84   1        time[4]=time[7]=time[10]=time[13]=time[16]=time[19]=0;
  85   1        while(1)
  86   1        {
  87   2          switch(i)
  88   2          {
  89   3            case 1:GUI_Text(40,128,time,Green,Black);GUI_Text(40+8*20,128,time+20,Red,White);break;
  90   3            case 2:GUI_Text(40+8*5,128,time+5,Green,Black);GUI_Text(40,128,time,Red,White);break;
  91   3            case 3:GUI_Text(40+8*8,128,time+8,Green,Black);GUI_Text(40+8*5,128,time+5,Red,White);break;
  92   3            case 4:GUI_Text(40+8*11,128,time+11,Green,Black);GUI_Text(40+8*8,128,time+8,Red,White);break;
  93   3            case 5:GUI_Text(40+8*14,128,time+14,Green,Black);GUI_Text(40+8*11,128,time+11,Red,White);break;
  94   3            case 6:GUI_Text(40+8*17,128,time+17,Green,Black);GUI_Text(40+8*14,128,time+14,Red,White);break;
  95   3            case 7:GUI_Text(40+8*20,128,time+20,Green,Black);GUI_Text(40+8*17,128,time+17,Red,White);break;
  96   3          }
  97   2          Get_Click1(&x,&y);
  98   2          if(y>288&&y<320){guiddo(t_menu,desktop,x);}//???
  99   2          if((x>=40&&x<=80)&&(y>=180&&y<=200)){i++;while(!PEN);}  //Next ???
 100   2          if((x>=150&&x<=190)&&(y>=180&&y<=200))  //Ok ???
 101   2          {
 102   3            setime[0]=((time[17]-'0')<<4)|(time[18]-'0');
 103   3            setime[1]=((time[14]-'0')<<4)|(time[15]-'0');
 104   3            setime[2]=((time[11]-'0')<<4)|(time[12]-'0');
 105   3            setime[3]=((time[8]-'0')<<4)|(time[9]-'0');
 106   3            setime[4]=((time[5]-'0')<<4)|(time[6]-'0');
 107   3            setime[5]=time[20]-'0';
 108   3            setime[6]=((time[2]-'0')<<4)|(time[3]-'0');
 109   3            Ds1302_Write_Time(setime);//??????
 110   3            alert("已设定系统时间!",0x051d);
 111   3            while(!PEN);
 112   3          } 
 113   2          if((x>=100&&x<=140)&&(y>=105&&y<=125))  //? ???
 114   2          {
 115   3            switch(i)
 116   3            {
C51 COMPILER V9.52.0.0   CALENDAR                                                          07/20/2015 13:12:16 PAGE 3   

 117   4              case 1:time[3]++;if(time[3]>'9') {time[3]='0';time[2]++;}if(time[2]>'9') time[2]='0';break;
 118   4              case 2:time[6]++;if(time[6]>'2'&&time[5]=='1') {time[6]='1';time[5]='0';}if(time[6]>'9') {time[5]++;ti
             -me[6]='0';}break;
 119   4              case 3:time[9]++;if(time[9]>'1'&&time[8]=='3') {time[9]='1';time[8]='0';}if(time[9]>'9') {time[8]++;ti
             -me[9]='0';}break;
 120   4              case 4:time[12]++;if(time[12]>'3'&&time[11]=='2') {time[12]='0';time[11]='0';}if(time[12]>'9') {time[1
             -1]++;time[12]='0';}break;
 121   4              case 5:time[15]++;if(time[15]>'9'&&time[14]=='5') {time[15]='0';time[14]='0';}if(time[15]>'9') {time[1
             -4]++;time[15]='0';}break;
 122   4              case 6:time[18]++;if(time[18]>'9'&&time[17]=='5') {time[18]='0';time[17]='0';}if(time[18]>'9') {time[1
             -7]++;time[18]='0';}break;
 123   4              case 7:time[20]++;if(time[20]>'7') time[20]='1';
 124   4            }
 125   3            while(!PEN);
 126   3          } 
 127   2          if((x>=100&&x<=140)&&(y>=148&&y<=168))  //? ???
 128   2          {
 129   3            switch(i)
 130   3            {
 131   4              case 1:if(time[3]=='0'&&time[2]=='0') {time[3]='9';time[2]='9';} if(time[3]=='0'&&time[2]!='0') {time[
             -3]='9'+1;time[2]--;} time[3]--;break;
 132   4              case 2:if(time[6]=='1'&&time[5]=='0') {time[6]='2'+1;time[5]='1';} if(time[6]=='0'&&time[5]!='0') {tim
             -e[6]='9'+1;time[5]--;} time[6]--;break;
 133   4              case 3:if(time[9]=='1'&&time[8]=='0') {time[9]='1'+1;time[8]='3';} if(time[9]=='0'&&time[8]!='0') {tim
             -e[9]='9'+1;time[8]--;} time[9]--;break;
 134   4              case 4:if(time[12]=='0'&&time[11]=='0') {time[12]='3'+1;time[11]='2';} if(time[12]=='0'&&time[11]!='0'
             -) {time[12]='9'+1;time[11]--;} time[12]--;break;
 135   4              case 5:if(time[15]=='0'&&time[14]=='0') {time[15]='9'+1;time[14]='5';} if(time[15]=='0'&&time[14]!='0'
             -) {time[15]='9'+1;time[14]--;} time[15]--;break;
 136   4              case 6:if(time[18]=='0'&&time[17]=='0') {time[18]='9'+1;time[17]='5';} if(time[18]=='0'&&time[17]!='0'
             -) {time[18]='9'+1;time[17]--;} time[18]--;break;
 137   4              case 7:if(time[20]=='1')time[20]='7'+1;time[20]--;
 138   4            }
 139   3            
 140   3            while(!PEN);
 141   3          }
 142   2          if (i>7) i=1;
 143   2        }
 144   1      }
 145          /***************
 146          闹钟
 147          ***************/
 148          void t_alert()
 149          {
 150   1        LCD_Clear(0x051d);
 151   1        guidshow();
 152   1        while(1)
 153   1        {
 154   2          Get_Click(&x,&y);
 155   2          if(y>288&&y<320) guiddo(t_menu,t_menu,x);
 156   2        }
 157   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   3079    ----
   CONSTANT SIZE    =     84    ----
   XDATA SIZE       =   ----      10
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
C51 COMPILER V9.52.0.0   CALENDAR                                                          07/20/2015 13:12:16 PAGE 4   

END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
